<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
	    <!-- Popup mode de paiement -->
   		<record model="ir.ui.view" id="view_a_facturer_form">
			<field name="name">a.facturer.form</field>
			<field name="model">a.facturer</field>
			<field name="arch" type="xml"> 
				<form string="Mode de paiement" version="7">
                    <sheet>
                        <group>
                            <field name="a_facturer" string="Pourcentage %"/>
                        </group>
                    </sheet>
                    <footer>
                        <button string='Valider' name="valider_pourcentage_a_facturer" type="object" class="btn-primary"/>
                        <button string="Annuler" class="btn-default" special="cancel"/>
                    </footer>
                </form>
			</field>
		</record>
		<!-- Fin popup mode de paiement -->
		
		<!-- Action popup mode de paiement -->
		<record id="action_a_facturer" model="ir.actions.act_window">
            <field name="name">a.facturer.form</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">a.facturer</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_a_facturer_form"/>
            <!-- <field name="context">{'default_mode_paiement': journal_id}</field> -->
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a pourcentage de montant à facturer. 
              </p>
            </field>
        </record>
	    <!-- Fin action popup a facturer -->
		<!-- Budget Expense Report form perte -->
		<record id="budget_request_stock_form_facturation_perte_materiel" model="ir.ui.view">
            <field name="name">budget.request.form.stock.perte.materiel</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="stock_heri.budget_request_stock_form"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
            	<xpath expr="//form" position="attributes">
                    <attribute name="create">0</attribute>
                </xpath> 
				<field name="partner_id" position="replace">
				    <field name="partner_id" string="Entrepreneur"/>
				</field>
                <field name="state" position="replace">
				    <field name="state" widget="statusbar" statusbar_visible="nouveau,avis_logistique,avis_finance,attente_validation,etab_facture,ne_pas_payer,bonci_et_bons" />
				</field>
				<field name="partner_id" position="after">
				    <field name="breq_id_sale" invisible="1" />
				    <field name="is_breq_id_sale" invisible="1" />	  
				    <field name="is_facture_comptabilise" invisible="1" />	  
				</field>
				<xpath expr="//field[@name='order_line']" position="attributes">
					<attribute name="attrs">{'readonly': [('state', 'in', ('bonci_et_bons'))]}</attribute>
				</xpath>
				<field name="state" position="before">	
					<button name="envoyer_logistique" 
							string="Pour visa" 
							type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_call_center_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('nouveau')),'|',('is_breq_stock', '=', False),('is_breq_id_sale', '=', False)]}"/>				
					<button name="envoyer_au_finance" 
							string="Vu" 
							type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_logistique_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('avis_logistique')),('is_breq_stock', '=', False)]}"/>
                    <button name="envoyer_au_DG" 
							string="A valider par DG" 
							type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_finance_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('avis_finance')),('is_breq_stock', '=', False)]}"/>
                    <button name="facturer_entrepreneur" 
							string="Facturer" 
							type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_finance_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('avis_finance')),('is_breq_stock', '=', False)]}"/>
                    <button 
                    		name="a_facturer"
							string="A Facturer" 
							type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_dg_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('attente_validation')),('is_breq_stock', '=', False)]}"/>
                     <button
              				name="ne_pas_facturer"  
							string="Ne pas Facturer" 
							type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_dg_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('attente_validation')),('is_breq_stock', '=', False)]}"/>
                    <button  
                    		name ="generer_bci_et_bs"
							string="Envoyer au logistique" 
							type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_finance_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('ne_pas_payer','etab_facture')),('is_breq_stock', '=', False)]}"/>
               
				</field>
					<xpath expr="//div[@name='button_box']//button[@name='action_bs_lie']" position="before">
			      		<button name="action_impayee_facture"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-pencil-square-o"
                            attrs="{'invisible': ['|',('state', 'not in', ('avis_finance','attente_validation')),'|',('is_breq_stock', '=', False),('impayee_count','=',0)]}"
                            >
                            <field name="impayee_count" widget="statinfo" string="Impayées"/>
                  		</button>
                  	</xpath>
                  	<xpath expr="//div[@name='button_box']//button[@name='action_bs_lie']" position="after">
				 		<button type="object"
                            name="action_bci_et_bs_lie_facturation_perte"
                            class="oe_stat_button"
                            icon="fa-truck" attrs="{'invisible':[('state', '!=', 'bonci_et_bons')]}">
                            <field name="bci_bs_lie_count" widget="statinfo" string="Bons de cession interne et bon de sortie" help="Bons de cession interne et bon de sortie rattaché au BReq stock"/>
                        </button>
                	</xpath>
                	<xpath expr="//div[@name='button_box']//button[@name='action_bs_lie']" position="after">
				 		 <button type="object"
                            name="action_sale_order"
                            class="oe_stat_button"
                            icon="fa-usd"
                            attrs="{'invisible': [('sale_order_count','=',0)]}">
                            <field name="sale_order_count" widget="statinfo" string="Ventes aux Tiers" help="Vente aux tiers fait par l'entrepreneur"/>
                      	</button>
                	</xpath>
 
            </field>
        </record>
		<!-- Budget Request stock menu action perte-->
	    <record model="ir.actions.act_window" id="action_budget_request_facturation_perte">
	       	<field name="name">Budget request stock</field>
	       	<field name="res_model">purchase.order</field>
			<field name="domain">[('facturation_type','=','facturation_perte_materiel')]</field>
			<field name="context">{'default_is_breq_stock': True,'default_is_breq_id_sale': True,'default_mouvement_type': 'bs','default_facturation_type': 'facturation_perte_materiel'}</field>
	       	<field name="view_type">form</field>
	       	<field name="view_mode">tree,form</field>
	       	<field name="help" type="html">
         	<p class="oe_view_nocontent_create">
	             Click here to create a new Budget Request Stock Facturation Perte
         	</p>
	       </field>
	   	</record>
	   	
        <record id="action_br_stock_tree_heri_facturation_perte" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="stock_heri.budget_request_stock_tree"/>
            <field name="act_window_id" ref="action_budget_request_facturation_perte"/>
        </record>

        <record id="action_br_stock_form_heri_facturation_perte" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="budget_request_stock_form_facturation_perte_materiel"/>
            <field name="act_window_id" ref="action_budget_request_facturation_perte"/>
		</record>
		<!-- Fin budget request stock -->
		<menuitem 
		    id="menu_perte_materiel" 
		    name="Facturation des pertes de materiels" 
		    parent="sales_team.menu_sales" 
		    action="action_budget_request_facturation_perte" 
		    sequence="2"/>
	</data>
</odoo>