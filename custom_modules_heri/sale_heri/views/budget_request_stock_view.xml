<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
	    <!-- Budget Expense Report form ando-->
		<record id="budget_request_stock_materiel_entrepreneur_form" model="ir.ui.view">
            <field name="name">budget.request.form.stock.heri</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="stock_heri.budget_request_stock_form"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
                
               	<field name="state" position="replace">
				    <field name="state" widget="statusbar" statusbar_visible="nouveau,test,bs" />
				</field>
				<field name="partner_id" position="after">
				    <field name="breq_id_sale" invisible="1" />
				    <field name="is_breq_id_sale" invisible="1" />	  
				    <field name="is_facture_comptabilise" invisible="1" />	  
				</field>
				<field name="location_id" position="replace">
				    <field name="location_id" readonly="1" />  
				</field>
				<field name="location_id" position="after">
				    <field name="kiosque_id"  readonly="1" />  
				</field>
				<field name="state" position="before">					
					<button name="envoyer_pour_tester" 
							string="A tester" 
							type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_magasinier_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('nouveau')),'|',('is_breq_stock', '=', False),('is_breq_id_sale', '=', False)]}"/>
					<button name="creer_bs" 
							string="Générer le bon de sortie" 
							type="object"
							groups="purchase_heri.group_technicien_heri"
							class="oe_highlight" 
                       		attrs="{'invisible': ['|',('state', 'not in', ('test')),('is_breq_stock', '=', False)]}"/>
                    <button name="annule_test" 
                    		string="A revoir" 
                    		type="object"
                    		groups="purchase_heri.group_technicien_heri"
							class="oe_highlight" 
                       		attrs="{'invisible': ['|',('state', 'not in', ('test')),('is_breq_stock', '=', False)]}"/>
                    
				</field>
				<xpath expr="//div[@name='button_box']//button[@name='action_bs_lie']" position="before">
				 	<button type="object"
				 				name="action_breq_stock_lie_facture"
	                            attrs="{'invisible': ['|',('state', 'not in', ('etab_facture','comptabilise'))]}"
	                            class="oe_stat_button"
	                            icon="fa-pencil-square-o">
	                            <field name="breq_facture_stock_count"  widget="statinfo" string="Facture" help="Facture Breq Stock"/>
	                            <field name="breq_facture_stock_ids" invisible="1"/>
	                </button>
                </xpath>
                <xpath expr="//div[@name='button_box']//button[@name='action_bs_lie']" position="replace">
				 	<button type="object"
                            name="action_bs_lie_facturation_tiers"
                            class="oe_stat_button"
                            icon="fa-truck" attrs="{'invisible':[('state','not in',('bs'))]}">
                            <field name="bs_lie_count" widget="statinfo" string="Bons de sortie" help="Bons de sortie rattaché au BReq stock"/>
                            <field name="picking_ids_bs" invisible="1"/>
                        </button>
                </xpath>
				
            </field>
        </record>
        
	    <!-- Budget Expense Report form mirado-->
		<record id="budget_request_stock_form_heri" model="ir.ui.view">
            <field name="name">budget.request.form.stock.heri</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="stock_heri.budget_request_stock_form"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
                <field name="amount_tax" position="replace">
				    <field name="amount_tax" widget="monetary" options="{'currency_field': 'currency_id'}"/>
				</field>
                <field name="taxes_id" position="replace">
				    <field name="taxes_id" widget="many2many_tags" />
				</field>
                <field name="state" position="replace">
				    <field name="state" widget="statusbar" statusbar_visible="nouveau,test,etab_facture,comptabilise" />
				</field>
				<field name="partner_id" position="after">
				    <field name="breq_id_sale" invisible="1" />
				    <field name="is_breq_id_sale" invisible="1" />	  
				    <field name="is_facture_comptabilise" invisible="1" />	  
				</field>
				<field name="location_id" position="replace">
				    <field name="location_id" readonly="1" />  
				</field>
				<field name="state" position="before">					
					<button name="envoyer_pour_tester1" 
							string="A tester" 
							type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_magasinier_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('nouveau')),'|',('is_breq_stock', '=', False),('is_breq_id_sale', '=', False)]}"/>
					<button name="envoyer_pour_facturation" 
							string="Test OK" 
							type="object"
							groups="purchase_heri.group_technicien_heri"
							class="oe_highlight" 
                       		attrs="{'invisible': ['|',('state', 'not in', ('test')),('is_breq_stock', '=', False)]}"/>
                    <button name="annule_facturation" 
                    		string="A revoir" 
                    		type="object"
                    		groups="purchase_heri.group_technicien_heri"
							class="oe_highlight" 
                       		attrs="{'invisible': ['|',('state', 'not in', ('test')),('is_breq_stock', '=', False)]}"/>
                    <button name="comptabiliser_sale" 
                    		string="Comptabilise" 
                    		type="object"
							class="oe_highlight" 
							groups="purchase_heri.group_finance_heri"
                       		attrs="{'invisible': ['|',('state', 'not in', ('etab_facture')),'|',('is_breq_stock', '=', False),('is_facture_comptabilise', '=', False)]}"/>
				</field>
				<xpath expr="//div[@name='button_box']//button[@name='action_bs_lie']" position="before">
				 	<button type="object"
				 				name="action_breq_stock_lie_facture"
	                            attrs="{'invisible': ['|',('state', 'not in', ('etab_facture','comptabilise'))]}"
	                            class="oe_stat_button"
	                            icon="fa-pencil-square-o">
	                            <field name="breq_facture_stock_count"  widget="statinfo" string="Facture" help="Facture Breq Stock"/>
	                            <field name="breq_facture_stock_ids" invisible="1"/>
	                </button>
                </xpath>
                <xpath expr="//div[@name='button_box']//button[@name='action_bs_lie']" position="replace">
				 	<button type="object"
                            name="action_bs_lie_facturation_tiers"
                            class="oe_stat_button"
                            icon="fa-truck" attrs="{'invisible':[('state','not in',('comptabilise'))]}">
                            <field name="bs_lie_count" widget="statinfo" string="Bons de sortie" help="Bons de sortie rattaché au BReq stock"/>
                            <field name="picking_ids_bs" invisible="1"/>
                        </button>
                </xpath>
				
            </field>
        </record>
        <!-- Budget request stock tree view -->			
		<record model="ir.ui.view" id="budget_request_stock_tree_heri">
	        <field name="name">Budget request stock</field>
	        <field name="model">purchase.order</field>
	        <field name="arch" type="xml">
	            <tree string="Budget Request" decoration-bf="message_unread==True" decoration-muted="state=='cancel'">
	            	<field name="message_unread" invisible="1"/>
                    <field name="name" string="Reference"/>
                    <field name="employee_id"/>
                    <field name="department_id"/>
	                <field name="partner_id" invisible="1"/>
                    <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                    <field name="date_planned" invisible="context.get('quotation_only', False)"/>
                    <field name="amount_untaxed" sum="Total Untaxed amount" string="Untaxed" widget="monetary"/>
                    <field name="amount_total" sum="Total amount" widget="monetary" invisible="1"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="change_state_date"/>
                    <field name="statut_budget"/>
                    <field name="state" string="Etat BReq"/>
                    <field name="statut_bex" invisible="1"/>
                     <field name="statut_facture"/>
                    <field name="is_creator" invisible="1"/>
                    <field name="invoice_status" invisible="not context.get('show_purchase', False)"/>
	            </tree>
	        </field>
	    </record>
		<!-- Fin Budget request stock tree -->	
        <!-- Fin form breq stock -->
        
	 	<!-- Budget Request stock menu action lie -->
	    <record model="ir.actions.act_window" id="action_budget_request_stock_heri_lie">
	       	<field name="name">Budget request stock</field>
	       	<field name="res_model">purchase.order</field>
			<field name="domain">[('breq_id_sale','=',active_id)]</field>
			<field name="context">{'default_is_breq_stock': True,'default_is_breq_id_sale': True,'default_partner_id':1,'default_mouvement_type': 'bs'}</field>
	       	<field name="view_type">form</field>
	       	<field name="view_mode">tree,form</field>
	       	<field name="help" type="html">
         	<p class="oe_view_nocontent_create">
	             Click here to create a new Budget Request Stock lie.
         	</p>
	       </field>
	   	</record>
	   	
        <record id="action_br_stock_tree_heri_lie" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="sale_heri.budget_request_stock_tree_heri"/>
            <field name="act_window_id" ref="sale_heri.action_budget_request_stock_heri_lie"/>
        </record>

        <record id="action_br_stock_form_heri_lie" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="sale_heri.budget_request_stock_form_heri"/>
            <field name="act_window_id" ref="sale_heri.action_budget_request_stock_heri_lie"/>
		</record>
		<!-- Fin budget request stock -->
		
		<!-- Budget Request stock menu action lie -->
	    <record model="ir.actions.act_window" id="action_budget_request_stock_heri_2">
	       	<field name="name">Budget request stock</field>
	       	<field name="res_model">purchase.order</field>
			<field name="domain">[('breq_id_sale','=',active_id)]</field>
			<field name="context">{'default_is_breq_stock': True,'default_is_breq_id_sale': True,'default_partner_id':1,'default_mouvement_type': 'bs'}</field>
	       	<field name="view_type">form</field>
	       	<field name="view_mode">tree,form</field>
	       	<field name="help" type="html">
         	<p class="oe_view_nocontent_create">
	             Click here to create a new Budget Request Stock lie.
         	</p>
	       </field>
	   	</record>
	   	<record id="action_br_stock_tree_heri_lie2" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="sale_heri.budget_request_stock_tree_heri"/>
            <field name="act_window_id" ref="sale_heri.action_budget_request_stock_heri_2"/>
        </record>
	   	<record id="action_br_stock_form_heri_lie2" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="sale_heri.budget_request_stock_materiel_entrepreneur_form"/>
            <field name="act_window_id" ref="sale_heri.action_budget_request_stock_heri_2"/>
		</record>
		
		<!--  budget request stock facture-->
		<record model="ir.ui.view" id="facturation_tiers_form_view_facturation">
			<field name="name">sale.facturation.tiers.invoice</field>
			<field name="model">account.invoice</field>
			<field name="mode">primary</field>
			<field name="inherit_id" ref="sale_heri.account_invoice_form_view_advanced"/>
			<field name="arch" type="xml">
			    <field name="invoice_line_tax_ids" position="replace">
				    <field 
				        name="invoice_line_tax_ids" 
				        widget="many2many_tags" 
				        options="{'no_create': True}"/>
				</field>
				<field name="partner_id" position="before">
					<field name="breq_stock_id" invisible="1" />
				</field>
				<field name="state" position="replace">
				    <field name="state" widget="statusbar" statusbar_visible="draft,open,paid"/>
				</field>
				<xpath expr="//button[@name='action_invoice_open'][1]" position="attributes">
		    		<attribute name="invisible">1</attribute>
		    	</xpath>
		    	<xpath expr="//button[@name='action_invoice_sent']" position="attributes">
		    		<attribute name="invisible">1</attribute>
		    	</xpath>
		    	<xpath expr="//button[@name='action_invoice_cancel']" position="attributes">
		    		<attribute name="groups">purchase_heri.group_finance_heri</attribute>
		    	</xpath>
		    	<xpath expr="//button[@name='%(account.action_account_invoice_refund)d']" position="attributes">
		    		<attribute name="invisible">1</attribute>
		    	</xpath>
		    	<xpath expr="//button[@name='%(account.action_account_invoice_payment)d']" position="attributes">
		    		<attribute name="string">Comptabiliser</attribute>
		    		<attribute name="groups">purchase_heri.group_finance_heri</attribute>
		    		<attribute name="attrs">{'invisible':['|',('sent','=',False)]}</attribute>
		    	</xpath>
		    	<xpath expr="//button[@name='invoice_print'][1]" position="attributes">
		    		<attribute name="string">Edition</attribute>
		    		<attribute name="groups">purchase_heri.group_special_manager_heri</attribute>
		    	</xpath>
		    	<xpath expr="//button[@name='invoice_print'][2]" position="attributes">
		    		<attribute name="invisible">1</attribute>
		    	</xpath>
		    	<xpath expr="//field[@name='state']" position="before">
		    		<button name="print_duplicata" string="Imprimer" attrs="{'invisible': ['|',('state', 'not in', ('paid'))]}" type="object" class="oe_highlight" />
		    		<button name="action_pour_visa" string="Pour visa" attrs="{'invisible': ['|',('state', 'not in', ('draft'))]}" groups="purchase_heri.group_finance_heri" type="object" class="oe_highlight" />
		    	</xpath>
			</field>
		</record>
		 <record model="ir.actions.act_window" id="action_budget_request_stock_heri_lie_facture">
	       	<field name="name">Facture</field>
	       	<field name="res_model">account.invoice</field>
			<field name="domain">['|',('breq_stock_id','=',active_id),('breq_id_sale','=',active_id)]</field>
	       	<field name="view_type">form</field>
	       	<field name="view_mode">tree,form</field>
	       	<field name="help" type="html">
         	<p class="oe_view_nocontent_create">
	             Click here to create a new Facture.
         	</p>
	       </field>
	   	</record>
		<record id="action_br_stock_tree_heri_lie_facture" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="account.invoice_tree"/>
            <field name="act_window_id" ref="sale_heri.action_budget_request_stock_heri_lie_facture"/>
		</record>
        <record id="action_br_stock_form_heri_lie_facture" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="sale_heri.facturation_tiers_form_view_facturation"/>
            <field name="act_window_id" ref="sale_heri.action_budget_request_stock_heri_lie_facture"/>
		</record>
		
		<!-- Debut bon de sortie facturation form view -->
		<record id="view_bs_stock_form_facturation_tiers_inherit" model="ir.ui.view">
            <field name="name">stock.sortie.facture.form</field>
            <field name="model">stock.picking</field>
            <field name="mode">primary</field>
            <field name="inherit_id" ref="stock_heri.view_picking_form_advanced"/>
            <field name="arch" type="xml">
                <field name="state" position="replace">
				    <field name="state" widget="statusbar" statusbar_visible="attente_magasinier,attente_logistique,assigned,done" />
				</field>
				<xpath expr="//button[@name='do_stock_transfer']" position="attributes">
					<attribute name="groups">purchase_heri.group_magasinier_heri</attribute>
					<attribute name="invisible">1</attribute>
				</xpath>
				<xpath expr="//button[@name='action_cancel']" position="attributes">
					<attribute name="attrs">{'invisible': [('state','in',('done','attente_logistique'))]}</attribute>
					<attribute name="groups">purchase_heri.group_logistique_heri</attribute>
				</xpath>
				<xpath expr="//header" position="inside">		
				    <button name="aviser_logistique" string="Pour visa" class="oe_highlight" attrs="{'invisible': ['|',('state','not in',('attente_magasinier')),('mouvement_type','not in',('bs'))]}" groups="purchase_heri.group_magasinier_heri" type="object"/>
				    <button name="action_aviser_magasinier_bs" string="Vu" class="oe_highlight" attrs="{'invisible': ['|',('state','not in',('attente_logistique')), ('mouvement_type','not in',('bs'))]}" groups="purchase_heri.group_logistique_heri" type="object"/>
				</xpath>
				<field name="min_date" position="after">
        			<field name="date_arrivee_relle" />
    			</field>
            </field>
        </record>
        
        <record model="ir.actions.act_window" id="action_bon_de_sortie_lie_facture_tiers">
	       	<field name="name">Bon de sortie en stock lié</field>
	       	<field name="res_model">stock.picking</field>
	       	<field name="domain">['&amp;',('breq_id','=',active_id),'&amp;',('mouvement_type','=','bs'),('state','!=','draft')]</field>  	
	       	<field name="view_type">form</field>
	       	<field name="view_mode">tree,form</field>
	   	</record> 
	   	
	   	<record id="action_bon_sortie_tree_lie_facture_tiers" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="stock.vpicktree"/>
            <field name="act_window_id" ref="sale_heri.action_bon_de_sortie_lie_facture_tiers"/>
        </record>
        
        <record id="action_bon_sortie_form_lie_facture_tiers" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="sale_heri.view_bs_stock_form_facturation_tiers_inherit"/>
            <field name="act_window_id" ref="sale_heri.action_bon_de_sortie_lie_facture_tiers"/>
		</record>
	</data>
</odoo>