<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="external_layout_footer_heri" name='Footer HERI Redevance'>
        <div class="footer">
            <div class="last-page">
                <div class="row">
                    <div class="col-xs-12" style="font-style:italic; font-size:12px; font-family:Garuda;">
                        <u>Tsara ho fantatra:</u><br/>
                        <p style="margin-left:10px; border-bottom:solid black 1px;">
                            1. Ny tsy fandoavana ara-potoana (farafahatarany ny faha 15 ny volana) ny faktiora (Franchise Fee) dia mitarika fandoavana 5 isanjato (5%) amin'ny tsy voaefa izay mipetraka ao amin'ny faktioran'ny vola manaraka.
                        </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12" style="font-size:11px;">
                        <table class="table table-bordered" style="table-layout:fixed;">
                            <tr>
                                <td class="text-center" style="width:25%;">LE CLIENT</td>
                                <td class="text-center" style="width:15%;">Direction Commerciale</td>
                                <td class="text-center" style="width:15%;">Direction</td>
                                <td  style="width:45%;" rowspan="3">
                                    KAONTY AFAHANAO MANDOA VOLA <br/>
                                    * BNI: <span t-field="company.bank_bni" /><br/>
                                    * Acces Banque: <span t-field="company.acces_bank" /><br/>
                                    * M VOLA: <span t-field="company.mvola" /><br/>
                                    * Airtel Money: <span t-field="company.airtel_money" /><br/>
                                    * ORANGE MONEY: <span t-field="company.orange_money" />
                                </td>
                            </tr>
                            <tr>
                                <td style="height:50px !important;"/>
                                <td rowspan="2"/>
                                <td rowspan="2"/>
                            </tr>
                            <tr>
                                <td class="text-center"><i>Nom + Signature + Cachet</i></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="report_invoice_redevance" name="Facture Redevance">
        <t t-call="report.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-set="company" t-value="res_company"/>
                <!-- <t t-call="report.external_layout_header"/> -->

                <div class="page">
                    <div class="row">
                        <div class="col-xs-6">
                            <div style="margin-left:20px; font-size:10px; font-family:Courier, monospace">
	                			<img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % company.logo" style="max-height: 100px;"/><br/>
	                			<span t-esc="company.street"/><br/>
	                			<span t-esc="company.street2"/><br/>
	                			<span t-esc="company.city"/><br/>
	                			Num Stat: <span t-esc="company.num_stat"/><br/>
	                			NIF: <span t-esc="company.nif"/><br/>
	                			RCS: <span t-esc="company.rcs"/><br/>
	                			CIF: <span t-esc="company.cif"/><br/>
	                			TEL: <span t-esc="company.phone"/><br/>
	                			<span t-esc="str(company.website).replace('http://', '')"/><br/>
                			</div>
                		</div>
            			
                        <div class='col-xs-6 pull-right mt64'>
                            <p t-if="o.invoice_type == 'rental'" class="text-center" style="font-size:31px;"><b><span t-if="o.state in ('draft','proforma2')">PROFORMA </span>FACTURE REDEVANCE</b></p>
                            <p t-if="o.invoice_type == 'sale'" class="text-center" style="font-size:31px;"><b><span t-if="o.state in ('draft','proforma2')">PROFORMA </span>FACTURE VENTE</b></p>
                            <p t-if="o.invoice_type == 'loss'" class="text-center" style="font-size:31px;"><b><span t-if="o.state in ('draft','proforma2')">PROFORMA </span>FACTURE PERTE</b></p>
                            <p t-if="o.invoice_type == 'refund'" class="text-center" style="font-size:31px;"><b><span t-if="o.state in ('draft','proforma2')">PROFORMA </span>FACTURE D'AVOIR</b></p>
                            
                            <div class="row">
                                <div class="col-xs-5 text-right">MOIS DE:</div>
                                <div class="col-xs-5 text-center"><span t-if="o.date_invoice"
                                t-esc="'{:%B}'.format(datetime.datetime.strptime(o.date_invoice, '%Y-%m-%d')).capitalize()" /></div>
                            </div>
                            <div class="row mt16">
                                <div class="col-xs-5 text-right">DATE: </div>
                                <div class="col-xs-5 text-center">
                                    <div style="border:1px solid #3E3E3E;">
                                        <span t-if="o.date_invoice" t-field="o.date_invoice" />
                                        <t t-if="not o.date_invoice">
                                            <br/>
                                        </t>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-5 text-right">Facture N°:</div>
                                <div class="col-xs-5 text-center">
                                    <div style="border:1px solid #3E3E3E; border-top: 0px">
                                        <span t-if="o.number" t-field="o.number" />
                                        <t t-if="not o.number">
                                            <br/>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt16 mb16">
                        <div class="col-xs-5">
                            <!-- <div style="background-color:#3E3E3E; color:white; font-weight:bold;" class="text-center">VOTRE INTERLOCUTEUR</div>
                            <div class="row">
                                <div class="col-xs-3 text-right">
                                    Tél:<br/>
                                    Email:
                                </div>
                                <div class="col-xs-9">
                                    <span t-field="company.phone" /><br/>
                                    <span t-field="company.email" />
                                </div>
                            </div> -->
                            
                            <div style="border:solid #3E3E3E 1px;">
                                <div style="background-color:#3E3E3E; color:white; font-weight:bold;" class="text-center">HISTORIQUE</div>
                                <div style="height:115px;">
                                    <i><span t-field="o.comment" /></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-7">
                            <div style="background-color:#3E3E3E; color:white; font-weight:bold;" class="col-xs-12 text-center">FACTURÉ À : </div>
                            <div t-if="o.invoice_type in ('rental','loss') or o.invoice_type == 'refund' and o.refund_invoice_id.invoice_type in ('rental','loss')" class="col-xs-3" >Localité</div>
                            <div t-if="o.invoice_type in ('rental','loss') or o.invoice_type == 'refund' and o.refund_invoice_id.invoice_type in ('rental','loss')" class="col-xs-9">: <span t-field="o.kiosk_id.name" /></div>
                            <div class="col-xs-3">
	                            <span t-if="o.invoice_type in ('rental','loss') or o.invoice_type == 'refund' and o.refund_invoice_id.invoice_type in ('rental','loss')">Entrepreneur</span>
	                            <span t-if="o.invoice_type == 'sale' or o.invoice_type == 'refund' and o.refund_invoice_id.invoice_type == 'sale'">Client</span>
                            </div>
                            <div class="col-xs-9">: <span t-field="o.partner_id" /></div>
                            <div class="col-xs-3">Adresse</div>
                            <div class="col-xs-9">: <span t-field="o.partner_id.street" /></div>
                            <div class="col-xs-3">Téléphone</div>
                            <div class="col-xs-9">: <span t-field="o.partner_id.phone" /></div>
                            <div class="col-xs-3">Email</div>
                            <div class="col-xs-9">: <span t-field="o.partner_id.email" /></div>
                            <div class="col-xs-3">CIN</div>
                            <div class="col-xs-9">: <span t-field="o.partner_id.cin" /></div>
                        </div>
                    </div>

                    <t t-set="currency_precision" t-value="res_company.currency_id.decimal_places" />
                    <div class="row">
                        <div class="col-xs-12">
                            <table class="table table-condensed table-bordered" style="table-layout:fixed;">
                                <thead>
                                    <tr style="background-color:#3E3E3E; color:white; border-top:solid #3E3E3E 4px;">
                                        <th class="text-center" style="width:10%; border-color:#3E3E3E !important;">Date</th>
                                        <th class="text-center" style="width:45%; border-color:#3E3E3E !important;">Description</th>
                                        <th class="text-center" style="width:8%; border-color:#3E3E3E !important;">Quantité</th>
                                        <th class="text-center" style="width:8%; border-color:#3E3E3E !important;">Unité</th>
                                        <th class="text-center" style="width:6%; border-color:#3E3E3E !important;">Jours</th>
                                        <th class="text-center" style="width:10%; border-color:#3E3E3E !important;">PU HT</th>
                                        <th class="text-center" style="width:13%; border-color:#3E3E3E !important;">Total HT</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="o.invoice_line_ids" t-as="line">
                                         <td class="text-center" style="border-color:#3E3E3E !important;"><span t-field="line.date" /></td>
                                         <td style="border-color:#3E3E3E !important;"><span t-field="line.name" /></td>
                                         <td class="text-center" style="border-color:#3E3E3E !important;"><span t-field="line.quantity" /></td>
                                         <td class="text-center" style="border-color:#3E3E3E !important;"><span t-field="line.uom_id" /></td>
                                         <td class="text-center" style="border-color:#3E3E3E !important;"><span t-field="line.number_days" /></td>
                                         <td class="text-center" style="border-color:#3E3E3E !important;"><span t-field="line.price_discounted" /></td>
                                         <td class="text-center" style="border-color:#3E3E3E !important;"><t t-esc="line.price_subtotal" t-options="{'widget': 'float', 'precision': currency_precision}" /></td>
                                     </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-7" style="font-weight:bold;">
                            <div class="text-center col-xs-12" style="background-color:#3E3E3E; color:white; border:solid #3E3E3E 1px;">CONDITIONS DE VENTE</div>
                            <div class="col-xs-12" style="border:solid #3E3E3E 1px;">
                                <u>Mode de règlement: </u><span t-field="o.payment_term_id" />
                                <div class="col-xs-12" style="height:80px;">
                                    <div class="col-xs-3 col-xs-offset-3">
                                        <span t-field="o.date_invoice" />
                                    </div>
                                    <div class="col-xs-5 col-xs-offset-1">
                                        <!-- <t t-set="amount_to_pay" t-value="'{:10,.2f}'.format(o.amount_total-o.advance).replace(',', ' ').replace('.', ',')"/> -->
                                        <span t-if="o.invoice_type == 'refund'">-</span><span t-esc="o.residual" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-5">
                            <div class="row mt4">
                                <div class="col-xs-7 text-right"><b>TOTAL HT en <span t-field="o.currency_id.symbol" /> :</b></div>
                                <div class="col-xs-5 text-center"><t t-esc="o.amount_untaxed" t-options="{'widget': 'float', 'precision': currency_precision}"/></div>
                            </div>
                            <div class="row mt4">
                                <div class="col-xs-7 text-right"><b>TVA en <span t-field="o.currency_id.symbol" /> :</b></div>
                                <div class="col-xs-5 text-center"><t t-esc="o.amount_tax" t-options="{'widget': 'float', 'precision': currency_precision}" /></div>
                            </div>
                            <div class="row mt4">
                                <div class="col-xs-7 text-right"><b>TOTAL TTC en <span t-field="o.currency_id.symbol" /> :</b></div>
                                <div class="col-xs-5 text-center"><t t-esc="o.amount_total" t-options="{'widget': 'float', 'precision': currency_precision}" /></div>
                            </div>
                            <div class="row mt4">
                                <div class="col-xs-7 text-right"><b>Acompte versé en <span t-field="o.currency_id.symbol" /> :</b></div>
                                <div class="col-xs-5 text-center"><t t-esc="o.advance" t-options="{'widget': 'float', 'precision': currency_precision}" /></div>
                            </div>
                            <div class="row mt4">
                                <div class="col-xs-7 text-right"><b>Net à payer en <span t-field="o.currency_id.symbol" /> :</b></div>
                                <div class="col-xs-5 text-center"><t t-esc="o.residual" t-options="{'widget': 'float', 'precision': currency_precision}" /></div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb8 mt8">
                        <div class="col-xs-12">
                            <div>Arrêtée la présente facture à la somme de : <b><i><span t-field="o.amount_in_word"/></i></b></div>
                        </div>
                    </div>
                    <div class="row mb8">
                        <div class="col-xs-4" >
                            <div class="col-xs-12" style="background-color:#3E3E3E; color:white;">Payable avant le <span t-field="o.date_due" /></div>
                        </div>
                    </div>
                    <div t-if="o.invoice_type == 'refund'" class="row">
                        <div class="col-xs-12" style="color:black;"><b>Objet de l'avoir : </b><span t-field="o.origin" /></div>
                 	</div>
                </div>

                <t t-call="sale_advanced_heri.external_layout_footer_heri" />
            </t>
        </t>
    </template>

    <report
        id="action_report_invoice_redevance"
        model="account.invoice"
        report_type="qweb-pdf"
        string="Facture Redevance"
        paperformat="sale_advanced_heri.invoice_sale_paperformat"
        name="sale_advanced_heri.report_invoice_redevance"
        file="sale_advanced_heri.report_invoice_redevance" 
        menu="False"/>

</odoo>